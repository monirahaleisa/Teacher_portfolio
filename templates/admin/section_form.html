{% extends 'admin/base.html' %}

{% block title %}إضافة/تعديل قسم{% endblock %}
{% block header_title %}{% if section %}تعديل قسم{% else %}إضافة قسم جديد{% endif %}{% endblock %}

{% block content %}
<div class="section-form">
    <form method="post" action="{% if section %}{{ url_for('admin.edit_section', section_id=section.id) }}{% else %}{{ url_for('admin.new_section') }}{% endif %}">
        <div class="form-group">
            <label for="title">عنوان القسم</label>
            <input type="text" id="title" name="title" class="form-control" value="{% if section %}{{ section.title }}{% endif %}" required>
        </div>
        
        <div class="form-group">
            <label for="slug">الرابط (بالإنجليزية، بدون مسافات أو أحرف خاصة)</label>
            <input type="text" id="slug" name="slug" class="form-control" value="{% if section %}{{ section.slug }}{% endif %}" required>
            <small class="form-text">مثال: personal-file</small>
        </div>
        
        <div class="form-group">
            <label for="parent_id">القسم الأب (اختياري)</label>
            <select id="parent_id" name="parent_id" class="form-control">
                <option value="">-- بدون قسم أب --</option>
                {% for s in sections %}
                    {% if not section or s.id != section.id %}
                        <option value="{{ s.id }}" {% if section and section.parent_id == s.id %}selected{% endif %}>{{ s.title }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">حفظ</button>
            <a href="{{ url_for('admin.sections') }}" class="btn btn-secondary">إلغاء</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('title').addEventListener('input', function() {
        // Only auto-generate slug if it's a new section or if the slug field hasn't been manually edited
        if (!document.getElementById('slug').value || document.getElementById('slug').dataset.autoGenerated === 'true') {
            const title = this.value;
            const slug = title
                .toLowerCase()
                .replace(/[\u0600-\u06FF]/g, '') // Remove Arabic characters
                .replace(/[^\w\s-]/g, '') // Remove special characters
                .replace(/\s+/g, '-') // Replace spaces with hyphens
                .replace(/-+/g, '-') // Replace multiple hyphens with a single hyphen
                .trim(); // Trim leading/trailing spaces
            
            document.getElementById('slug').value = slug;
            document.getElementById('slug').dataset.autoGenerated = 'true';
        }
    });
    
    document.getElementById('slug').addEventListener('input', function() {
        // If user manually edits the slug, stop auto-generating
        this.dataset.autoGenerated = 'false';
    });
</script>
{% endblock %}
